package com.zs.aidata.cmcc.dccp.service;

import com.zs.aidata.core.tools.BaseCoreService;
import com.zs.aidata.core.tools.RestTemplateUtils;
import com.zs.aidata.cmcc.dccp.vo.DccpOutVO;

import javax.inject.Named;
import java.util.HashMap;
import java.util.Map;

/**
 * 和彩云
 *
 * @author 张顺
 * @since 2020/10/18
 */
@Named
public class DccpService extends BaseCoreService implements IDccpService {

    public static void main(String[] args) {
        DccpService dccpService = new DccpService();
        dccpService.getVerificationCode("734d900f83cda193f8407a5fda1e01d0ce1854158dcc2cfac62ef51ad0a442bc3689c4a885a8bac0ce51f7f57a6d9bd88e3ad3bb6d39c55c2acb3d9eadb5a45c65b718629a59fc5f7c4f0131adcf7b8fb08ae59d1420d82ce3284c5cfa4d18ce36fa22e61a7834b9bb4024c0f02b5f4f96f1a5575079c885a33fcaaf774ceeac391c17940e2b8a5b72554befc820c6cb3d814bf92b21d173f11f25ac8fe986973c9284f08f85a8f07279850a4f24ccf5a6dc4ae84f446240f71b2d0aec364cf2521ed2b2b4f6bb3ad0a0a1ce18a587e6df9e22625be988a1cb047668b532adb75bc394eff223cb165205fed8bfb6652eacc5835f7253c7ed607cc09e92fd34bb");
    }


    /**
     * 获取验证码
     */
    private String getVerificationCode(String tel) {
        Map<String, String> header = new HashMap<>();
        header.put("Accept", "application/json, text/javascript, */*; q=0.01");
        header.put("Connection", "keep-alive");
        // 这个SESSION很关键
        header.put("Cookie", "dp_vstif=FF413092FD1F695FE5EC10E6A5EE8E538D5D9D7BD3E428AEEA8DE859789D2452230671A642BBA30552A3AEDB1DDD0186A0B544C3A6E776BFFA98C849E41FDBC40F6872AA5F8AD7F50E1877E316F27F703165CF394E996BF56CA51793BC3ED68DEE42AE51F698463D5BF4C0C0E7E7182F4307A0E0C7C949FF895B92B6DE285183B98EC4F2E6796F96682C3F426B98F1C91E3B97AA321A86D8EE29BBB629F89B89D319D9F99098B4B71879D834771B1CEDAD5D8EFFBAA33298037C814C125E9BE00CB5BF6F605E0B0409AB35708254800BB4D18094868FA802F3C50F03E4CD8E76B8B14DADFD0C13B51E673A3F0FC866AA47D0AF09B51F8F289CDF8840EDF18F6F0177DAF44DEC94751FA0147A0969506667A63E182A3C309D309B97AF25A19558178808053CE99808ABC29DAF351D86461F1D609411C1E5772277FB0D4E954652BA04332BBAD9603649E752AA7ED77BB6336F70327FA3CC3B49737F9A02902F734AAF905D17918E6C540332CB76246ECAD82BAEF29B29AA7C3BAE42CE04BF495917595B421905BD5696E5E092DF035E11; dp_vtfs=4BA72B0A831F97D280FC7D4C2553468E36A25AD3F8FFE76286EC2FACE1C1DDF3553E0A25413083006FDB6CBB5B8DEA52E75801CDFEBF336BBA466F0A61B3FE447F3D75455D246E8A3973C1B8F53E7481878951045116D30B6CC63797AEC445268C6CF8ED9151907799DD0EE0CE300C28ABC20D3C62B4AEF3120E0202CE4FF28CBC62D27BC0E7DFA608CBB77622EBA5C0DE861BD809FBB56F69186A04E29EEC1110930D206CE705F2B2F3CC667E0ECCFF89210CF90334BF13A653F644B183ECBE24ED8C939B85A98D732E84BAF11DE279BAA95A1181CD9F384A9F92F1D82723C2ECAF9E4A20C5ED0D8A9049580A1409FF7F0C3491A701C0CCF2C65FFE8DE15E54DC505D3856BF6CB30510E4A3CF8CB37A5011D86DAA6F0C8CC50F46927601B547F48E6FB6842C59E881DA24B62131DB3EF4BA4F6687B32CCBB7E88008D01E6BDA8CE4CE2CA66E09BCA22CC472A984BA16B3D9450DD6C3CD0951FF8B46D6657ACFCC5E3F3A00465A24533D63BDE00CE3021367858C99C9F3CFC87E188F660872E1DF2D0C839B71190876297F164D2EC6EDE8E870E3E76BF565256A4B608F07157096627A7FD991DFBFE8AC0179455FF36675E90A31F05FE583AF34F50239D8BF018726CB012CE71EA318941B29C3E71E1B506D8CA898FE0C2B074F8D3E0EB07B099D80E948EB37665E2B91DA6B598CE836BE172A5503DC2931904BE9B7EA37545A576070F49FB3E994F73E58891D927CEE; SESSION=4fc02ca8-25a0-4436-8b4e-79ac4d071f8e; SERVERID=61975982a92bc81e76e457bc0dd0b2b3|1603212417|1603208044; WT_FPC=id=2591c7c372d3a6c24ec1603208046588:lv=1603212417927:ss=1603210089227; mobile=39064-2056-4908-20512; JSESSIONID=E7B94E4A2EEE055B34A4EEA90C9D7821");
        header.put("Host", "gd.dccp.liuliangjia.cn");
        header.put("Origin", "http://gd.dccp.liuliangjia.cn");
        header.put("Referer", "http://gd.dccp.liuliangjia.cn/dccp-portal/guangdong/views/zero/index.jsp");
        header.put("User-Agent", "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36");
        header.put("X-Requested-With", "XMLHttpRequest");

        Map<String, String> params = new HashMap<>();
        params.put("loginTel", tel);
        params.put("smsCodeType", "LOGIN");
        params.put("implClass", "gdAuthSmsCodeService");
        return RestTemplateUtils.execHttpRequest(URL_SEND_SMS_CODE, "post", params, header);
    }


    @Override
    public DccpOutVO sendSmsCode(String tel) {
        DccpOutVO out = new DccpOutVO();
        out.setMessage(getVerificationCode(tel));
        return out;
    }
}
